<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" data-i18n="focus.description" data-i18n-attr="content"
        content="ê´‘ê³  ì—†ëŠ” ë¬´ë£Œ ì§‘ì¤‘ íƒ€ì´ë¨¸ì™€ ë°±ìƒ‰ì†ŒìŒ - ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸ë¡œ ìƒì‚°ì„±ì„ ë†’ì´ì„¸ìš”">
    <meta name="keywords" data-i18n="focus.keywords" data-i18n-attr="content" content="ì§‘ì¤‘íƒ€ì´ë¨¸, ë½€ëª¨ë„ë¡œ, ë°±ìƒ‰ì†ŒìŒ, ê³µë¶€íƒ€ì´ë¨¸, ë¬´ë£Œíƒ€ì´ë¨¸">
    <title data-i18n="focus.page_title">ì§‘ì¤‘ - ê´‘ê³  ì—†ëŠ” ë¬´ë£Œ íƒ€ì´ë¨¸</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-41EYC7QS6F"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-41EYC7QS6F');
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">

    <!-- Resource Hints: Preload critical resources -->
    <link rel="preload" href="../src/js/main.js" as="script" crossorigin>
    <link rel="preload" href="../src/css/focus-timer.css" as="style">
    <link rel="prefetch" href="../index.html">

    <script>
        (function () {
            function setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
            }
            try {
                var savedTheme = localStorage.getItem('theme');
                if (savedTheme) {
                    setTheme(savedTheme);
                } else {
                    var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    setTheme(prefersDark ? 'dark' : 'light');
                }
            } catch (error) {
                var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                setTheme(prefersDark ? 'dark' : 'light');
            }
        })();
    </script>
</head>

<body>
    <header>
        <div class="container">
            <button class="language-toggle" onclick="toggleLanguage()" data-i18n="home.lang_toggle_label"
                data-i18n-attr="aria-label" aria-label="ì–¸ì–´ ì „í™˜">KO</button>
            <button class="theme-toggle" onclick="toggleTheme()" data-i18n="common.theme_toggle"
                data-i18n-attr="aria-label" aria-label="ë‹¤í¬ëª¨ë“œ í† ê¸€">ğŸŒ™</button>
            <h1 data-i18n="focus.title">ğŸ¯ ì§‘ì¤‘</h1>
            <p class="subtitle" data-i18n="focus.subtitle">ê´‘ê³  ì—†ëŠ” ë¬´ë£Œ íƒ€ì´ë¨¸</p>
        </div>
    </header>

    <div class="tool-container">
        <a href="../index.html" class="back-button" data-i18n="common.home">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

        <div class="focus-main-section">
            <!-- íƒ€ì´ë¨¸ ì„¹ì…˜ -->
            <div class="focus-card">
                <h2 class="focus-card-title" data-i18n="focus.pomodoro_timer_title">â±ï¸ ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸</h2>
                <div class="timer-container">
                    <svg class="timer-svg" viewBox="0 0 300 300">
                        <circle class="timer-circle-bg" cx="150" cy="150" r="140"></circle>
                        <circle class="timer-circle-progress" cx="150" cy="150" r="140" id="timerProgress"></circle>
                    </svg>
                    <div class="focus-timer-display" id="timerDisplay">25:00</div>
                </div>
                <div class="focus-timer-controls">
                    <button class="btn btn-action" onclick="toggleTimer()" id="startBtn"
                        data-i18n="focus.btn_start">ì‹œì‘</button>
                    <button class="btn btn-secondary" onclick="resetTimer()" data-i18n="focus.btn_reset">ë¦¬ì…‹</button>
                </div>
                <div class="focus-timer-presets">
                    <button class="focus-preset-btn active" onclick="setTimer(event, 25)"
                        data-i18n="focus.minutes_25">25ë¶„</button>
                    <button class="focus-preset-btn" onclick="setTimer(event, 15)"
                        data-i18n="focus.minutes_15">15ë¶„</button>
                    <button class="focus-preset-btn" onclick="setTimer(event, 45)"
                        data-i18n="focus.minutes_45">45ë¶„</button>
                    <button class="focus-preset-btn" onclick="setTimer(event, 60)"
                        data-i18n="focus.minutes_60">60ë¶„</button>
                </div>
                <p class="focus-info-text" data-i18n="focus.timer_info_text">ì§‘ì¤‘ ì‹œê°„ì„ ì„¤ì •í•˜ê³  ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì„¸ìš”</p>
            </div>

            <!-- ë°±ìƒ‰ì†ŒìŒ ì„¹ì…˜ -->
            <div class="focus-card">
                <h2 class="focus-card-title" data-i18n="focus.white_noise_title">ğŸµ ë°±ìƒ‰ì†ŒìŒ</h2>
                <div class="focus-sound-grid">
                    <div class="focus-sound-item" onclick="toggleSound(event, 'rain')">
                        <span class="focus-sound-name" data-i18n="focus.sound_rain">â˜” ë¹—ì†Œë¦¬</span>
                        <span class="focus-status-indicator" id="status-rain"></span>
                    </div>
                    <div class="focus-sound-item" onclick="toggleSound(event, 'wave')">
                        <span class="focus-sound-name" data-i18n="focus.sound_wave">ğŸŒŠ íŒŒë„ ì†Œë¦¬</span>
                        <span class="focus-status-indicator" id="status-wave"></span>
                    </div>
                    <div class="focus-sound-item" onclick="toggleSound(event, 'cafe')">
                        <span class="focus-sound-name" data-i18n="focus.sound_cafe">â˜• ì¹´í˜ ì†ŒìŒ</span>
                        <span class="focus-status-indicator" id="status-cafe"></span>
                    </div>
                    <div class="focus-sound-item" onclick="toggleSound(event, 'white')">
                        <span class="focus-sound-name" data-i18n="focus.sound_white">âšª í™”ì´íŠ¸ ë…¸ì´ì¦ˆ</span>
                        <span class="focus-status-indicator" id="status-white"></span>
                    </div>
                </div>
                <div class="focus-volume-control">
                    <label class="form-group label" data-i18n="focus.volume_label">ë³¼ë¥¨</label>
                    <input type="range" min="0" max="100" value="50" class="focus-volume-slider" id="volumeSlider"
                        oninput="changeVolume(this.value)">
                </div>
                <p class="focus-info-text" data-i18n="focus.noise_info_text">ë°°ê²½ìŒìœ¼ë¡œ ì§‘ì¤‘ë ¥ì„ ë†’ì—¬ë³´ì„¸ìš”</p>
            </div>
        </div>

        <!-- Buy Me a Coffee ë²„íŠ¼ -->
        <div class="sponsor-card">
            <h3>â˜• Buy Me a Coffee</h3>
            <p data-i18n="common.sponsor_message">ì´ ì„œë¹„ìŠ¤ê°€ ìœ ìš©í•˜ì…¨ë‹¤ë©´ ì»¤í”¼ í•œ ì” í›„ì›í•´ì£¼ì„¸ìš”!</p>
            <a href="https://buymeacoffee.com/pm430" target="_blank" class="btn-sponsor">
                <span>â˜•</span>
                <span data-i18n="common.sponsor_btn">ì»¤í”¼ í•œ ì” í›„ì›í•˜ê¸°</span>
            </a>
        </div>
    </div>

    <footer>
        <div class="container">
            <p data-i18n="common.footer">&copy; 2025 Lux Vera. Made with â¤ï¸</p>
        </div>
    </footer>

    <script type="module" src="../src/js/main.js"></script>
    <script type="module">
        import I18n from '../src/js/i18n.js';
        import Utils from '../src/js/utils.js';
        import '../src/css/focus-timer.css';

        // íƒ€ì´ë¨¸ ë³€ìˆ˜
        let timerInterval = null;
        let timeLeft = 25 * 60; // ì´ˆ ë‹¨ìœ„
        let isRunning = false;
        let selectedMinutes = 25;

        // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸
        let audioContext = null;
        let sounds = {};

        // í…Œë§ˆ í† ê¸€
        window.toggleTheme = function () {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            try {
                localStorage.setItem('theme', newTheme);
            } catch (error) {
                console.warn('localStorage unavailable:', error);
            }
            updateThemeIcon();
        }

        // í…Œë§ˆ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        function updateThemeIcon() {
            const toggleBtn = document.querySelector('.theme-toggle');
            if (toggleBtn) {
                const theme = document.documentElement.getAttribute('data-theme');
                toggleBtn.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í…Œë§ˆ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        updateThemeIcon();

        // íƒ€ì´ë¨¸ í•¨ìˆ˜ë“¤
        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timerDisplay').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            // SVG Progress ì—…ë°ì´íŠ¸
            const circle = document.getElementById('timerProgress');
            const radius = 140;
            const circumference = 2 * Math.PI * radius;
            const totalSeconds = selectedMinutes * 60;
            const offset = circumference - (timeLeft / totalSeconds) * circumference;

            circle.style.strokeDasharray = circumference;
            circle.style.strokeDashoffset = offset;
        }

        window.toggleTimer = function () {
            const btn = document.getElementById('startBtn');
            if (isRunning) {
                clearInterval(timerInterval);
                btn.textContent = I18n.t('focus.btn_start');
                isRunning = false;
            } else {
                timerInterval = setInterval(() => {
                    if (timeLeft > 0) {
                        timeLeft--;
                        updateDisplay();
                    } else {
                        clearInterval(timerInterval);
                        playTimerEndSound();
                        btn.textContent = I18n.t('focus.btn_start');
                        isRunning = false;
                        alert(I18n.t('focus.alert_time_complete'));
                    }
                }, 1000);
                btn.textContent = I18n.t('focus.btn_pause');
                isRunning = true;
            }
        }

        window.resetTimer = function () {
            clearInterval(timerInterval);
            timeLeft = selectedMinutes * 60;
            updateDisplay();
            document.getElementById('startBtn').textContent = I18n.t('focus.btn_start');
            isRunning = false;
        }

        window.setTimer = function (event, minutes) {
            selectedMinutes = minutes;
            clearInterval(timerInterval);
            timeLeft = minutes * 60;
            updateDisplay();
            document.getElementById('startBtn').textContent = I18n.t('focus.btn_start');
            isRunning = false;

            // í”„ë¦¬ì…‹ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.focus-preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function playTimerEndSound() {
            if (!audioContext) initAudio();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // ì˜¤ë””ì˜¤ í•¨ìˆ˜ë“¤
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function createRainSound() {
            const bufferSize = 2 * audioContext.sampleRate;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = buffer.getChannelData(0);

            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }

            const noise = audioContext.createBufferSource();
            noise.buffer = buffer;
            noise.loop = true;

            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 1000;

            const gainNode = audioContext.createGain();
            gainNode.gain.value = 0.5;

            noise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);

            return { source: noise, gain: gainNode };
        }

        function createWaveSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();

            oscillator.type = 'sine';
            oscillator.frequency.value = 100;
            filter.type = 'lowpass';
            filter.frequency.value = 400;

            gainNode.gain.value = 0.3;

            // LFO for wave effect
            const lfo = audioContext.createOscillator();
            const lfoGain = audioContext.createGain();
            lfo.frequency.value = 0.5;
            lfoGain.gain.value = 50;

            lfo.connect(lfoGain);
            lfoGain.connect(oscillator.frequency);

            oscillator.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);

            return { source: oscillator, gain: gainNode, lfo: lfo };
        }

        function createCafeSound() {
            const bufferSize = 2 * audioContext.sampleRate;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = buffer.getChannelData(0);

            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }

            const noise = audioContext.createBufferSource();
            noise.buffer = buffer;
            noise.loop = true;

            const filter = audioContext.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = 800;
            filter.Q.value = 0.5;

            const gainNode = audioContext.createGain();
            gainNode.gain.value = 0.4;

            noise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);

            return { source: noise, gain: gainNode };
        }

        function createWhiteNoise() {
            const bufferSize = 2 * audioContext.sampleRate;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = buffer.getChannelData(0);

            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }

            const noise = audioContext.createBufferSource();
            noise.buffer = buffer;
            noise.loop = true;

            const gainNode = audioContext.createGain();
            gainNode.gain.value = 0.3;

            noise.connect(gainNode);
            gainNode.connect(audioContext.destination);

            return { source: noise, gain: gainNode };
        }

        window.toggleSound = function (event, type) {
            initAudio();

            if (sounds[type]) {
                // ì‚¬ìš´ë“œ ì¤‘ì§€
                sounds[type].source.stop();
                if (sounds[type].lfo) sounds[type].lfo.stop();
                delete sounds[type];
                document.getElementById(`status-${type}`).classList.remove('playing');
                event.currentTarget.classList.remove('active');
            } else {
                // ì‚¬ìš´ë“œ ì‹œì‘
                let sound;
                switch (type) {
                    case 'rain':
                        sound = createRainSound();
                        break;
                    case 'wave':
                        sound = createWaveSound();
                        if (sound.lfo) sound.lfo.start();
                        break;
                    case 'cafe':
                        sound = createCafeSound();
                        break;
                    case 'white':
                        sound = createWhiteNoise();
                        break;
                }
                sound.source.start();
                sounds[type] = sound;
                document.getElementById(`status-${type}`).classList.add('playing');
                event.currentTarget.classList.add('active');
            }
        }

        window.changeVolume = function (value) {
            const volume = value / 100;
            for (let type in sounds) {
                if (sounds[type].gain) {
                    sounds[type].gain.gain.value = volume;
                }
            }
        }

        // í˜ì´ì§€ ì´íƒˆ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            for (let type in sounds) {
                if (sounds[type].source) sounds[type].source.stop();
                if (sounds[type].lfo) sounds[type].lfo.stop();
            }
        });

        // ì–¸ì–´ í† ê¸€ (main.jsì˜ ì „ì—­ í•¨ìˆ˜ ì‚¬ìš©)

        document.addEventListener('DOMContentLoaded', () => {
            I18n.init();
        });
    </script>

    <!-- Buy Me a Coffee í”Œë¡œíŒ… ìœ„ì ¯ (asyncë¡œ ì§€ì—° ë¡œë“œ) -->
    <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
        data-id="pm430" data-description="Support me on Buy me a coffee!" data-message="ê°ì‚¬í•©ë‹ˆë‹¤!" data-color="#FFDD00"
        data-position="Right" data-x_margin="18" data-y_margin="18" async defer></script>
</body>

</html>

</html>